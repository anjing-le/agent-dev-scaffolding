---
title: 常见问题排查
description: 开发环境、类型错误、路由、API 请求和性能问题的排查解决方案
tags: [问题排查, 调试, 故障排除, 解决方案]
---

# 常见问题排查

## 开发环境问题

### 问题 1: 启动项目失败

**症状**: 执行 `pnpm dev` 后报错

**可能原因**:
1. Node 版本不符合要求
2. 依赖未安装或版本不匹配
3. 端口被占用

**解决方案**:

```bash
# 1. 检查 Node 版本（要求 >=20.19.0）
node -v

# 2. 清除依赖并重新安装
rm -rf node_modules pnpm-lock.yaml
pnpm install

# 3. 检查端口是否被占用（默认 5173）
lsof -i :5173

# 4. 修改端口（在 .env.development 中）
VITE_PORT=5174

# 5. 清除 Vite 缓存
rm -rf node_modules/.vite
pnpm dev
```

### 问题 2: 自动导入不生效

**症状**: 使用 `ref`、`computed` 等 API 时提示未定义

**可能原因**:
1. 自动导入配置文件未生成
2. IDE 未识别类型文件
3. tsconfig.json 配置问题

**解决方案**:

```bash
# 1. 删除并重新生成类型文件
rm -rf src/types/import/auto-imports.d.ts
rm -rf src/types/import/components.d.ts
rm -rf .auto-import.json

# 2. 重启开发服务器
pnpm dev

# 3. 重启 VSCode
# Command + Shift + P -> Reload Window

# 4. 检查 tsconfig.json 是否包含生成的类型文件
{
  "include": [
    "src/**/*",
    "src/**/*.d.ts"
  ]
}
```

### 问题 3: Element Plus 组件样式丢失

**症状**: Element Plus 组件显示异常，没有样式

**可能原因**:
1. unplugin-element-plus 配置问题
2. 样式导入顺序问题
3. CSS 变量未正确加载

**解决方案**:

```typescript
// 检查 vite.config.ts 配置
import ElementPlus from 'unplugin-element-plus/vite'

plugins: [
  ElementPlus({
    useSource: true // 确保设置为 true
  })
]

// 检查 main.ts 中的样式导入顺序
import '@/assets/styles/index.scss' // 应该在最后导入
```

```bash
# 清除缓存并重启
rm -rf node_modules/.vite
pnpm dev
```

## 类型错误

### 问题 4: TypeScript 类型报错

**症状**: 编辑器提示类型错误，但代码可以运行

**可能原因**:
1. 类型定义文件未生成
2. 全局类型未正确声明
3. tsconfig.json 配置问题

**解决方案**:

```bash
# 1. 运行类型检查
pnpm vue-tsc --noEmit

# 2. 检查 tsconfig.json
{
  "compilerOptions": {
    "strict": true,
    "types": ["vite/client", "node", "element-plus/global"]
  },
  "include": [
    "src/**/*",
    "src/**/*.d.ts"
  ]
}

# 3. 确保全局类型文件存在
# src/types/api/api.d.ts
# src/types/import/auto-imports.d.ts
# src/types/import/components.d.ts
```

### 问题 5: Api 命名空间找不到

**症状**: 使用 `Api.Auth.UserInfo` 时提示找不到命名空间

**可能原因**:
1. api.d.ts 文件未被包含
2. eslint 配置未声明全局变量

**解决方案**:

```typescript
// 1. 确保 api.d.ts 使用 declare 声明
// src/types/api/api.d.ts
declare namespace Api {
  namespace Auth {
    interface UserInfo {
      // ...
    }
  }
}

// 2. 在 eslint.config.mjs 中添加全局变量
languageOptions: {
  globals: {
    Api: 'readonly'
  }
}

// 3. 在 .vue 文件中可能需要重启 IDE
```

## 路由问题

### 问题 6: 路由跳转后页面空白

**症状**: 使用 `router.push` 跳转后页面空白

**可能原因**:
1. 路由组件路径错误
2. 路由守卫拦截
3. 组件导入失败

**解决方案**:

```typescript
// 1. 检查路由配置
{
  path: '/user',
  component: () => import('@views/system/user/index.vue') // 确保路径正确
}

// 2. 检查路由守卫
router.beforeEach((to, from, next) => {
  console.log('Route guard:', to.path)
  // 确保调用了 next()
  next()
})

// 3. 检查浏览器控制台是否有错误
// 4. 使用命名路由而不是路径
router.push({ name: 'SystemUser' })
```

### 问题 7: 路由参数丢失

**症状**: 跳转后 `route.params` 或 `route.query` 为空

**可能原因**:
1. 使用了错误的导航方式
2. 路由配置问题

**解决方案**:

```typescript
// ✅ 正确 - 使用 params（需要命名路由）
router.push({
  name: 'UserDetail',
  params: { id: 123 }
})

// ✅ 正确 - 使用 query
router.push({
  path: '/user/detail',
  query: { id: 123 }
})

// ❌ 错误 - path 和 params 不能同时使用
router.push({
  path: '/user/detail',
  params: { id: 123 } // params 会被忽略
})

// 在目标组件中获取
const route = useRoute()
console.log(route.params.id) // 123
console.log(route.query.id) // '123' (query 是字符串)
```

## API 请求问题

### 问题 8: API 请求跨域

**症状**: 浏览器控制台提示 CORS 错误

**可能原因**:
1. 后端未配置 CORS
2. Vite 代理配置错误
3. 请求地址错误

**解决方案**:

```typescript
// 1. 配置 Vite 代理（vite.config.ts）
server: {
  proxy: {
    '/api': {
      target: 'http://localhost:3000',
      changeOrigin: true,
      // rewrite: (path) => path.replace(/^\/api/, '') // 如果需要重写路径
    }
  }
}

// 2. 确保 API 请求使用相对路径
// src/api/auth.ts
export function fetchLogin(data: Api.Auth.LoginParams) {
  return request.post({
    url: '/api/auth/login', // 使用 /api 前缀触发代理
    data
  })
}

// 3. 检查环境变量
// .env.development
VITE_API_PROXY_URL=http://localhost:3000
```

### 问题 9: API 请求 401 未授权

**症状**: 已登录但 API 请求返回 401

**可能原因**:
1. Token 未正确携带
2. Token 已过期
3. 请求拦截器配置问题

**解决方案**:

```typescript
// 1. 检查请求拦截器（src/utils/http/index.ts）
service.interceptors.request.use(
  (config) => {
    const userStore = useUserStore()
    if (userStore.token) {
      // 确保 header 名称正确（可能是 Authorization 或 token）
      config.headers['Authorization'] = `Bearer ${userStore.token}`
    }
    return config
  }
)

// 2. 检查响应拦截器处理 401
service.interceptors.response.use(
  (response) => response,
  (error) => {
    if (error.response?.status === 401) {
      // 清除 token 并跳转登录
      const userStore = useUserStore()
      userStore.logout()
    }
    return Promise.reject(error)
  }
)

// 3. 检查 token 是否正确存储
console.log(userStore.token) // 确认 token 存在
```

### 问题 10: API 请求没有响应

**症状**: 发起请求后一直 pending，没有响应

**可能原因**:
1. 后端服务未启动
2. 网络问题
3. 请求超时设置太长
4. 请求被阻塞

**解决方案**:

```typescript
// 1. 检查后端服务是否运行
// 浏览器访问 API 地址

// 2. 设置合理的超时时间
const service = axios.create({
  timeout: 10000 // 10 秒超时
})

// 3. 检查 Network 面板
// 查看请求状态和响应

// 4. 添加请求日志
service.interceptors.request.use((config) => {
  console.log('Request:', config.url, config)
  return config
})

service.interceptors.response.use(
  (response) => {
    console.log('Response:', response.config.url, response.data)
    return response
  },
  (error) => {
    console.error('Error:', error.config?.url, error)
    return Promise.reject(error)
  }
)
```

## 状态管理问题

### 问题 11: Pinia 状态不持久化

**症状**: 刷新页面后 store 数据丢失

**可能原因**:
1. persist 配置错误
2. localStorage 被清除
3. 浏览器隐私模式

**解决方案**:

```typescript
// 1. 检查 persist 配置
export const useUserStore = defineStore('user', () => {
  // ...
}, {
  persist: {
    key: 'user-store',
    storage: localStorage, // 或 sessionStorage
    paths: ['token', 'userInfo'] // 指定需要持久化的字段
  }
})

// 2. 检查 pinia 插件是否正确安装
// main.ts
import { createPinia } from 'pinia'
import piniaPluginPersistedstate from 'pinia-plugin-persistedstate'

const pinia = createPinia()
pinia.use(piniaPluginPersistedstate)

app.use(pinia)

// 3. 检查浏览器 localStorage
console.log(localStorage.getItem('user-store'))
```

### 问题 12: Store 响应式失效

**症状**: 修改 store 数据后视图不更新

**可能原因**:
1. 直接解构 store
2. 使用了普通对象而不是响应式对象

**解决方案**:

```vue
<script setup lang="ts">
import { useUserStore } from '@stores/user'
import { storeToRefs } from 'pinia'

// ✅ 正确 - 使用 storeToRefs
const userStore = useUserStore()
const { token, userInfo } = storeToRefs(userStore)

// ❌ 错误 - 直接解构（失去响应式）
const { token, userInfo } = useUserStore()

// ✅ 方法可以直接解构
const { login, logout } = userStore
</script>
```

## 构建部署问题

### 问题 13: 打包后页面空白

**症状**: `pnpm build` 后部署，页面空白

**可能原因**:
1. base 路径配置错误
2. 路由模式问题
3. 静态资源路径错误

**解决方案**:

```typescript
// 1. 检查 vite.config.ts 的 base 配置
export default defineConfig({
  base: '/', // 部署在根路径
  // 或
  base: '/my-app/', // 部署在子路径
})

// 2. 检查路由模式
// src/router/index.ts
const router = createRouter({
  history: createWebHistory(import.meta.env.BASE_URL), // 确保使用 BASE_URL
  routes
})

// 3. 检查 nginx 配置（如果使用 history 模式）
location / {
  try_files $uri $uri/ /index.html;
}
```

### 问题 14: 打包后样式错乱

**症状**: 打包后部分样式不生效

**可能原因**:
1. CSS 压缩问题
2. CSS 变量未正确加载
3. 样式加载顺序问题

**解决方案**:

```typescript
// 1. 检查 CSS 压缩配置
build: {
  minify: 'terser',
  terserOptions: {
    compress: {
      drop_console: true,
      drop_debugger: true
    }
  }
}

// 2. 确保 CSS 变量在 index.html 中定义
// public/index.html
<style>
  :root {
    --el-color-primary: #409eff;
  }
</style>

// 3. 检查样式导入顺序
// main.ts
import 'element-plus/dist/index.css'
import '@/assets/styles/index.scss'
```

## 性能问题

### 问题 15: 首屏加载慢

**症状**: 打开页面需要很长时间

**可能原因**:
1. 打包文件过大
2. 未使用懒加载
3. 图片资源过大

**解决方案**:

```typescript
// 1. 使用路由懒加载
{
  path: '/user',
  component: () => import('@views/system/user/index.vue')
}

// 2. 分析打包文件大小
// vite.config.ts
import { visualizer } from 'rollup-plugin-visualizer'

plugins: [
  visualizer({
    open: true,
    gzipSize: true,
    brotliSize: true
  })
]

// 3. 优化依赖预构建
optimizeDeps: {
  include: [
    'vue',
    'vue-router',
    'pinia',
    'element-plus'
  ]
}

// 4. 压缩图片
// 使用 webp 格式
// 使用图片 CDN
```

### 问题 16: 页面卡顿

**症状**: 操作页面时出现卡顿

**可能原因**:
1. 大列表未使用虚拟滚动
2. 深度监听大对象
3. 频繁的 DOM 操作

**解决方案**:

```vue
<script setup lang="ts">
// 1. 使用虚拟滚动
import { useVirtualList } from '@vueuse/core'

// 2. 避免深度监听
watch(
  () => largeObject.value.specificProperty,
  () => {
    // 只监听需要的属性
  }
)

// 3. 使用防抖
import { useDebounceFn } from '@vueuse/core'

const debouncedFn = useDebounceFn(() => {
  // 处理逻辑
}, 300)

// 4. 使用 shallowRef
const largeData = shallowRef({
  data: []
})
</script>
```

## 调试技巧

### 开发工具

```bash
# Vue DevTools
# 安装 Chrome 扩展

# 查看网络请求
# Chrome DevTools -> Network

# 查看 Console 日志
# Chrome DevTools -> Console

# 查看性能
# Chrome DevTools -> Performance

# 查看内存
# Chrome DevTools -> Memory
```

### 日志调试

```typescript
// 添加调试日志
console.log('Debug:', variable)
console.table(arrayData)
console.dir(objectData)

// 性能测量
console.time('fetchData')
await fetchData()
console.timeEnd('fetchData')

// 断点调试
debugger // 代码会在此处暂停
```
