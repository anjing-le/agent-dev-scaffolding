# ğŸš€ Backend Template é…ç½®æ–‡ä»¶
# ä¼ä¸šçº§Spring Bootè„šæ‰‹æ¶ - æ¡ä»¶åŒ–é…ç½®ç‰ˆæœ¬

# åŸºç¡€é…ç½®
server:
  port: 7777
  shutdown: graceful
  servlet:
    context-path: /

spring:
  application:
    name: backend-template
  
  # ç¯å¢ƒé…ç½®
  profiles:
    active: dev
  
  # æ•°æ®æºé…ç½®
  datasource:
    url: jdbc:mysql://10.5.139.166:3306/agent_x_dev?useUnicode=true&characterEncoding=utf8&serverTimezone=GMT%2B8&useSSL=false&allowPublicKeyRetrieval=true
    username: agent_x_dev
    password: zckWfqM4drM3V@L
    driver-class-name: com.mysql.cj.jdbc.Driver
    type: com.alibaba.druid.pool.DruidDataSource
    
    # Druidè¿æ¥æ± é…ç½®
    druid:
      # åˆå§‹è¿æ¥æ•°
      initial-size: 5
      # æœ€å°è¿æ¥æ± æ•°é‡
      min-idle: 10
      # æœ€å¤§è¿æ¥æ± æ•°é‡
      max-active: 20
      # é…ç½®è·å–è¿æ¥ç­‰å¾…è¶…æ—¶çš„æ—¶é—´
      max-wait: 60000
      # é…ç½®é—´éš”å¤šä¹…æ‰è¿›è¡Œä¸€æ¬¡æ£€æµ‹ï¼Œæ£€æµ‹éœ€è¦å…³é—­çš„ç©ºé—²è¿æ¥ï¼Œå•ä½æ˜¯æ¯«ç§’
      time-between-eviction-runs-millis: 60000
      # é…ç½®ä¸€ä¸ªè¿æ¥åœ¨æ± ä¸­æœ€å°ç”Ÿå­˜çš„æ—¶é—´ï¼Œå•ä½æ˜¯æ¯«ç§’
      min-evictable-idle-time-millis: 300000
      # é…ç½®ä¸€ä¸ªè¿æ¥åœ¨æ± ä¸­æœ€å¤§ç”Ÿå­˜çš„æ—¶é—´ï¼Œå•ä½æ˜¯æ¯«ç§’
      max-evictable-idle-time-millis: 900000
      # é…ç½®æ£€æµ‹è¿æ¥æ˜¯å¦æœ‰æ•ˆ
      validation-query: SELECT 1 FROM DUAL
      test-while-idle: true
      test-on-borrow: false
      test-on-return: false
      # æ‰“å¼€PSCacheï¼Œå¹¶ä¸”æŒ‡å®šæ¯ä¸ªè¿æ¥ä¸ŠPSCacheçš„å¤§å°
      pool-prepared-statements: true
      max-pool-prepared-statement-per-connection-size: 20
      # é…ç½®ç›‘æ§ç»Ÿè®¡æ‹¦æˆªçš„filtersï¼Œå»æ‰åç›‘æ§ç•Œé¢sqlæ— æ³•ç»Ÿè®¡ï¼Œ'wall'ç”¨äºé˜²ç«å¢™
      filters: stat,wall,slf4j
      # é€šè¿‡connectPropertieså±æ€§æ¥æ‰“å¼€mergeSqlåŠŸèƒ½ï¼›æ…¢SQLè®°å½•
      connection-properties: druid.stat.mergeSql\=true;druid.stat.slowSqlMillis\=5000
      # é…ç½®DruidStatFilter
      web-stat-filter:
        enabled: true
        url-pattern: "/*"
        exclusions: "*.js,*.gif,*.jpg,*.bmp,*.png,*.css,*.ico,/druid/*"
      # é…ç½®DruidStatViewServlet
      stat-view-servlet:
        enabled: true
        # è®¾ç½®ç™½åå•ï¼Œä¸å¡«åˆ™å…è®¸æ‰€æœ‰è®¿é—®
        allow: 127.0.0.1,192.168.0.0/16
        url-pattern: "/druid/*"
        # æ§åˆ¶å°ç®¡ç†ç”¨æˆ·åå’Œå¯†ç 
        login-username: admin
        login-password: admin123
      filter:
        stat:
          enabled: true
          # æ…¢SQLè®°å½•
          log-slow-sql: true
          slow-sql-millis: 1000
          merge-sql: true
        wall:
          config:
            multi-statement-allow: true
  
  # JPAé…ç½®
  jpa:
    hibernate:
      ddl-auto: update
    show-sql: true
    properties:
      hibernate:
        format_sql: true
        dialect: org.hibernate.dialect.MySQL8Dialect
        # æ˜¾ç¤ºSQLå‚æ•°ç»‘å®š
        show_sql: true
        use_sql_comments: true
        # ç»Ÿè®¡ä¿¡æ¯
        generate_statistics: false
  
  # Redisé…ç½®
#  data:
#    redis:
#      host: localhost
#      port: 6379
#      password:
#      database: 0
#      timeout: 5000
#      lettuce:
#        pool:
#          max-active: 8
#          max-wait: -1ms
#          max-idle: 8
#          min-idle: 0
  
  # Jacksoné…ç½®
  jackson:
    time-zone: Asia/Shanghai
    date-format: yyyy-MM-dd HH:mm:ss
    serialization:
      write-dates-as-timestamps: false
    deserialization:
      fail-on-unknown-properties: false

# ğŸ”¥ æ—¥å¿—é…ç½® - ç»Ÿä¸€æ ‡å‡†v1.0
# æ³¨æ„ï¼šè¯¦ç»†çš„æ—¥å¿—é…ç½®åœ¨ logback-spring.xml ä¸­ï¼ŒåŒ…æ‹¬æ–‡ä»¶è¾“å‡ºã€æ—¥å¿—åˆ†ç±»ç­‰
logging:
  level:
    root: INFO
    com.nodesk.backend_template: DEBUG
    org.springframework.web: INFO
    # Hibernate SQLæ—¥å¿—ï¼ˆå¼€å‘ç¯å¢ƒï¼‰
    org.hibernate.SQL: DEBUG
    org.hibernate.type.descriptor.sql.BasicBinder: TRACE
    # Spring Data JPAæ—¥å¿—
    org.springframework.data.jpa: DEBUG
    # æŠ‘åˆ¶JPA Named QueryæŸ¥æ‰¾æ—¥å¿—ï¼ˆæŠ‘åˆ¶ "Did not find named query" ä¿¡æ¯ï¼‰
    org.springframework.data.jpa.repository.query.NamedQuery: ERROR
    org.springframework.data.jpa.repository.query.QueryEnhancerFactory: WARN
    # Springæ¡†æ¶æ—¥å¿—
    org.springframework.boot: INFO
    org.springframework.security: INFO
    # è¿æ¥æ± æ—¥å¿—
    com.alibaba.druid: INFO
    # HTTPå®¢æˆ·ç«¯æ—¥å¿—
    org.apache.http: WARN
  pattern:
    # æ§åˆ¶å°æ ¼å¼ç”±logback-spring.xmlç»Ÿä¸€ç®¡ç†
    console: "%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n"
    # æ–‡ä»¶æ ¼å¼ç”±logback-spring.xmlç»Ÿä¸€ç®¡ç†
    file: "%d{yyyy-MM-dd HH:mm:ss.SSS} %-5level [%thread] %logger{40} - %msg%n"

# ğŸ”¥ è‡ªå®šä¹‰æ—¥å¿—é…ç½®
nodesk:
  logging:
    # æ—¥å¿—æ–‡ä»¶è·¯å¾„
    path: logs
    # åº”ç”¨IDï¼ˆç”¨äºæ—¥å¿—æ ‡è¯†ï¼‰
    app-id: ${spring.application.name}
    # æ˜¯å¦å¯ç”¨SQLæ—¥å¿—æ–‡ä»¶
    enable-sql-file: true
    # æ˜¯å¦å¯ç”¨JSONæ ¼å¼æ—¥å¿—
    enable-json-log: false
    # å¼‚æ­¥æ—¥å¿—é˜Ÿåˆ—å¤§å°
    async-queue-size: 1024
    # æ—¥å¿—å‹ç¼©é…ç½®
    compression:
      enabled: true
      # å‹ç¼©æ–‡ä»¶ä¿ç•™å¤©æ•°
      max-history: 30

# ç®¡ç†ç«¯ç‚¹
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics
  endpoint:
    health:
      show-details: when-authorized

# ğŸ›ï¸ åŠŸèƒ½ç‰¹æ€§é…ç½® - æ¡ä»¶åŒ–å¯ç”¨å„ç§åŠŸèƒ½
app:
  features:
    # RedisåŠŸèƒ½é…ç½®
    redis:
      enabled: false                    # æ˜¯å¦å¯ç”¨Redis
      host: localhost                  # Redisä¸»æœº
      port: 6379                      # Redisç«¯å£
      timeout: 5000                   # è¿æ¥è¶…æ—¶(æ¯«ç§’)
      cluster: false                  # æ˜¯å¦é›†ç¾¤æ¨¡å¼
    
    # ç¼“å­˜åŠŸèƒ½é…ç½®
    cache:
      enabled: true                   # æ˜¯å¦å¯ç”¨ç¼“å­˜
      type: redis                     # ç¼“å­˜ç±»å‹: redis/memory
      default-ttl: 3600              # é»˜è®¤è¿‡æœŸæ—¶é—´(ç§’)
      enable-stats: true              # æ˜¯å¦å¯ç”¨ç¼“å­˜ç»Ÿè®¡
    
    # åˆ†å¸ƒå¼é”åŠŸèƒ½é…ç½®
    distributed-lock:
      enabled: true                   # æ˜¯å¦å¯ç”¨åˆ†å¸ƒå¼é”
      provider: redisson              # é”æä¾›è€…: redisson/local
      default-wait-time: 10           # é»˜è®¤ç­‰å¾…æ—¶é—´(ç§’)
      default-expire-time: 30         # é»˜è®¤è¿‡æœŸæ—¶é—´(ç§’)
    
    # æ•°æ®åº“åŠŸèƒ½é…ç½®
    database:
      enabled: true                   # æ˜¯å¦å¯ç”¨æ•°æ®åº“
      show-sql: true                  # æ˜¯å¦æ˜¾ç¤ºSQL
      enable-auditing: true           # æ˜¯å¦å¯ç”¨JPAå®¡è®¡
      enable-pool-monitoring: true    # æ˜¯å¦å¯ç”¨è¿æ¥æ± ç›‘æ§
    
    # ä¸­é—´ä»¶åŠŸèƒ½é…ç½®
    middleware:
      # Kafkaæ¶ˆæ¯é˜Ÿåˆ—
      kafka:
        enabled: false                # æ˜¯å¦å¯ç”¨Kafka
        bootstrap-servers: localhost:9092
        group-id: backend-template
      
      # MinIOå¯¹è±¡å­˜å‚¨
      minio:
        enabled: false                # æ˜¯å¦å¯ç”¨MinIO
        endpoint: http://localhost:9000
        access-key: ""
        secret-key: ""
        bucket-name: default
      
      # OSSäº‘å­˜å‚¨
      oss:
        enabled: false                # æ˜¯å¦å¯ç”¨OSS
        provider: aliyun              # æä¾›å•†: aliyun/tencent/aws
        endpoint: ""
        access-key: ""
        secret-key: ""
        bucket-name: ""
    
    # ç›‘æ§åŠŸèƒ½é…ç½®
    monitoring:
      enabled: true                   # æ˜¯å¦å¯ç”¨ç›‘æ§
      enable-performance: true        # æ˜¯å¦å¯ç”¨æ€§èƒ½ç›‘æ§
      enable-health-check: true       # æ˜¯å¦å¯ç”¨å¥åº·æ£€æŸ¥
      enable-metrics: true            # æ˜¯å¦å¯ç”¨æŒ‡æ ‡æ”¶é›†
